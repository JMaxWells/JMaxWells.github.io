<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="iOS开发,多线程," />





  <link rel="alternate" href="/atom.xml" title="MaxWellPro's Hexo Blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta name="description" content="iOS多线程编程之NSThread的使用1、简介：1.1 iOS有三种多线程编程的技术，分别是：
1.、NSThread

2、Cocoa NSOperation （iOS多线程编程之NSOperation和NSOperationQueue的使用）

3、GCD  全称：Grand Central Dispatch（ iOS多线程编程之Grand Central Dispatch(GCD)介绍和使">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS多线程编程之NSThread的使用">
<meta property="og:url" content="http://yoursite.com/2016/03/21/iOS多线程编程之NSThread的使用/index.html">
<meta property="og:site_name" content="MaxWellPro's Hexo Blog">
<meta property="og:description" content="iOS多线程编程之NSThread的使用1、简介：1.1 iOS有三种多线程编程的技术，分别是：
1.、NSThread

2、Cocoa NSOperation （iOS多线程编程之NSOperation和NSOperationQueue的使用）

3、GCD  全称：Grand Central Dispatch（ iOS多线程编程之Grand Central Dispatch(GCD)介绍和使">
<meta property="og:image" content="http://img.my.csdn.net/uploads/201209/23/1348412756_8445.png">
<meta property="og:updated_time" content="2016-03-21T10:06:44.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS多线程编程之NSThread的使用">
<meta name="twitter:description" content="iOS多线程编程之NSThread的使用1、简介：1.1 iOS有三种多线程编程的技术，分别是：
1.、NSThread

2、Cocoa NSOperation （iOS多线程编程之NSOperation和NSOperationQueue的使用）

3、GCD  全称：Grand Central Dispatch（ iOS多线程编程之Grand Central Dispatch(GCD)介绍和使">
<meta name="twitter:image" content="http://img.my.csdn.net/uploads/201209/23/1348412756_8445.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"always"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 6260345940964541000,
      author: 'MaxWellPro'
    }
  };
</script>

  <title> iOS多线程编程之NSThread的使用 | MaxWellPro's Hexo Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta custom-logo">
  
    <div class="site-meta-headline">
      <a>
        <img class="custom-logo-image" src="http://image.woshipm.com/wp-files/2015/03/4ffce04d92a4d6cb21c1494cdfcd6dc1328.jpg"
             alt="MaxWellPro's Hexo Blog"/>
      </a>
    </div>
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">MaxWellPro's Hexo Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">分享一些技术文章和自己所整理的知识。</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                iOS多线程编程之NSThread的使用
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-03-21T17:42:35+08:00" content="2016-03-21">
              2016-03-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS开发/" itemprop="url" rel="index">
                    <span itemprop="name">iOS开发</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS开发/多线程/" itemprop="url" rel="index">
                    <span itemprop="name">多线程</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/03/21/iOS多线程编程之NSThread的使用/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/21/iOS多线程编程之NSThread的使用/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="iOS多线程编程之NSThread的使用"><a href="#iOS多线程编程之NSThread的使用" class="headerlink" title="iOS多线程编程之NSThread的使用"></a>iOS多线程编程之NSThread的使用</h1><h2 id="1、简介："><a href="#1、简介：" class="headerlink" title="1、简介："></a>1、简介：</h2><h3 id="1-1-iOS有三种多线程编程的技术，分别是："><a href="#1-1-iOS有三种多线程编程的技术，分别是：" class="headerlink" title="1.1 iOS有三种多线程编程的技术，分别是："></a>1.1 iOS有三种多线程编程的技术，分别是：</h3><ul>
<li><p>1.、NSThread</p>
</li>
<li><p>2、Cocoa NSOperation （iOS多线程编程之NSOperation和NSOperationQueue的使用）</p>
</li>
<li><p>3、GCD  全称：Grand Central Dispatch（ iOS多线程编程之Grand Central Dispatch(GCD)介绍和使用）</p>
</li>
</ul>
<p>这三种编程方式从上到下，抽象度层次是从低到高的，抽象度越高的使用越简单，也是Apple最推荐使用的。<br>这篇我们主要介绍和使用NSThread，后面会继续2、3 的讲解和使用。</p>
<h3 id="1-2-三种方式的有缺点介绍："><a href="#1-2-三种方式的有缺点介绍：" class="headerlink" title="1.2 三种方式的有缺点介绍："></a>1.2 三种方式的有缺点介绍：</h3><h4 id="NSThread"><a href="#NSThread" class="headerlink" title="NSThread:"></a>NSThread:</h4><p>优点：NSThread 比其他两个轻量级<br>缺点：需要自己管理线程的生命周期，线程同步。线程同步对数据的加锁会有一定的系统开销</p>
<p>NSThread实现的技术有下面三种：</p>
<h5 id="Cocoa-threads"><a href="#Cocoa-threads" class="headerlink" title="Cocoa threads"></a>Cocoa threads</h5><p>Cocoa implements threads using the NSThread class. Cocoa also provides methods on NSObject for spawning new threads and executing code on already-running threads. For more information, see “Using NSThread” and “Using NSObject to Spawn a Thread.”</p>
<h5 id="POSIX-threads"><a href="#POSIX-threads" class="headerlink" title="POSIX threads"></a>POSIX threads</h5><p>POSIX threads provide a C-based interface for creating threads. If you are not writing a Cocoa application, this is the best choice for creating threads. The POSIX interface is relatively simple to use and offers ample flexibility for configuring your threads. For more information, see “Using POSIX Threads”</p>
<h5 id="Multiprocessing-Services"><a href="#Multiprocessing-Services" class="headerlink" title="Multiprocessing Services"></a>Multiprocessing Services</h5><p>Multiprocessing Services is a legacy C-based interface used by applications transitioning from older versions of Mac OS. This technology is available in OS X only and should be avoided for any new development. Instead, you should use the NSThread class or POSIX threads. If you need more information on this technology, see Multiprocessing Services Programming Guide.</p>
<p>一般使用cocoa thread 技术。</p>
<h4 id="Cocoa-operation"><a href="#Cocoa-operation" class="headerlink" title="Cocoa operation"></a>Cocoa operation</h4><p>优点：不需要关心线程管理，数据同步的事情，可以把精力放在自己需要执行的操作上。<br>Cocoa operation 相关的类是 NSOperation ，NSOperationQueue。NSOperation是个抽象类，使用它必须用它的子类，可以实现它或者使用它定义好的两个子类：NSInvocationOperation 和 NSBlockOperation。创建NSOperation子类的对象，把对象添加到NSOperationQueue队列里执行。</p>
<h4 id="GCD"><a href="#GCD" class="headerlink" title="GCD"></a>GCD</h4><p>Grand Central Dispatch (GCD)是Apple开发的一个多核编程的解决方法。在iOS4.0开始之后才能使用。GCD是一个替代诸如NSThread, NSOperationQueue, NSInvocationOperation等技术的很高效和强大的技术。现在的iOS系统都升级到6了，所以不用担心该技术不能使用。<br>介绍完这三种多线程编程方式，我们这篇先介绍NSThread的使用。</p>
<h2 id="2、NSThread的使用"><a href="#2、NSThread的使用" class="headerlink" title="2、NSThread的使用"></a>2、NSThread的使用</h2><h3 id="2-1-NSThread-有两种直接创建方式："><a href="#2-1-NSThread-有两种直接创建方式：" class="headerlink" title="2.1 NSThread 有两种直接创建方式："></a>2.1 NSThread 有两种直接创建方式：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (id)initWithTarget:(id)target selector:(SEL)selector object:(id)argument</span><br><span class="line"></span><br><span class="line">+ (void)detachNewThreadSelector:(SEL)aSelector toTarget:(id)aTarget withObject:(id)anArgument</span><br></pre></td></tr></table></figure>
<p>第一个是实例方法，第二个是类方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[NSThread detachNewThreadSelector:@selector(doSomething:) toTarget:self withObject:nil];</span><br><span class="line">NSThread* myThread = [[NSThread alloc] initWithTarget:self</span><br><span class="line">                                        selector:@selector(doSomething:)</span><br><span class="line">                                        object:nil];</span><br><span class="line">[myThread start];</span><br></pre></td></tr></table></figure>
<h3 id="2-2-参数的意义："><a href="#2-2-参数的意义：" class="headerlink" title="2.2 参数的意义："></a>2.2 参数的意义：</h3><p>selector ：线程执行的方法，这个selector只能有一个参数，而且不能有返回值。<br>target  ：selector消息发送的对象<br>argument:传输给target的唯一参数，也可以是nil<br>第一种方式会直接创建线程并且开始运行线程，第二种方式是先创建线程对象，然后再运行线程操作，在运行线程操作前可以设置线程的优先级等线程信息</p>
<h3 id="2-3-PS-不显式创建线程的方法："><a href="#2-3-PS-不显式创建线程的方法：" class="headerlink" title="2.3 PS:不显式创建线程的方法："></a>2.3 PS:不显式创建线程的方法：</h3><p>用NSObject的类方法  performSelectorInBackground:withObject: 创建一个线程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Obj performSelectorInBackground:@selector(doSomething) withObject:nil];</span><br></pre></td></tr></table></figure>
<h3 id="2-4-下载图片的例子："><a href="#2-4-下载图片的例子：" class="headerlink" title="2.4 下载图片的例子："></a>2.4 下载图片的例子：</h3><h4 id="2-4-1-新建singeView-app"><a href="#2-4-1-新建singeView-app" class="headerlink" title="2.4.1  新建singeView app"></a>2.4.1  新建singeView app</h4><p>新建项目，并在xib文件上放置一个imageView控件。按住control键拖到viewController.h文件中创建imageView IBOutlet</p>
<p>ViewController.m中实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line">//  ViewController.m</span><br><span class="line">//  NSThreadDemo</span><br><span class="line">//</span><br><span class="line">//  Created by rongfzh on 12-9-23.</span><br><span class="line">//  Copyright (c) 2012年 rongfzh. All rights reserved.</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">#import &quot;ViewController.h&quot;</span><br><span class="line">#define kURL @&quot;http://avatar.csdn.net/2/C/D/1_totogo2010.jpg&quot;</span><br><span class="line">@interface ViewController ()</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation ViewController</span><br><span class="line"></span><br><span class="line">- (void)downloadImage:(NSString *) url&#123;</span><br><span class="line">    NSData *data = [[NSData alloc] initWithContentsOfURL:[NSURL URLWithString:url]];</span><br><span class="line">    UIImage *image = [[UIImage alloc]initWithData:data];</span><br><span class="line">    if(image == nil)&#123;</span><br><span class="line"></span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        [self performSelectorOnMainThread:@selector(updateUI:) withObject:image waitUntilDone:YES];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)updateUI:(UIImage*) image&#123;</span><br><span class="line">    self.imageView.image = image;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad</span><br><span class="line">&#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line"></span><br><span class="line">//    [NSThread detachNewThreadSelector:@selector(downloadImage:) toTarget:self withObject:kURL];</span><br><span class="line">    NSThread *thread = [[NSThread alloc]initWithTarget:self selector:@selector(downloadImage:) object:kURL];</span><br><span class="line">    [thread start];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)didReceiveMemoryWarning</span><br><span class="line">&#123;</span><br><span class="line">    [super didReceiveMemoryWarning];</span><br><span class="line">    // Dispose of any resources that can be recreated.</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<h4 id="2-4-2线程间通讯"><a href="#2-4-2线程间通讯" class="headerlink" title="2.4.2线程间通讯"></a>2.4.2线程间通讯</h4><p>线程下载完图片后怎么通知主线程更新界面呢？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[self performSelectorOnMainThread:@selector(updateUI:) withObject:image waitUntilDone:YES];</span><br><span class="line"></span><br><span class="line">performSelectorOnMainThread是NSObject的方法，除了可以更新主线程的数据外，还可以更新其他线程的比如：</span><br></pre></td></tr></table></figure>
<p>用：performSelector:onThread:withObject:waitUntilDone:</p>
<p>运行下载图片：</p>
<p><img src="http://img.my.csdn.net/uploads/201209/23/1348412756_8445.png" alt=""></p>
<p>图片下载下来了。</p>
<h3 id="2-5-线程同步"><a href="#2-5-线程同步" class="headerlink" title="2.5 线程同步"></a>2.5 线程同步</h3><p>我们演示一个经典的卖票的例子来讲NSThread的线程同步：<br>.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">@class ViewController;</span><br><span class="line"></span><br><span class="line">@interface AppDelegate : UIResponder &lt;UIApplicationDelegate&gt;</span><br><span class="line">&#123;</span><br><span class="line">    int tickets;</span><br><span class="line">    int count;</span><br><span class="line">    NSThread* ticketsThreadone;</span><br><span class="line">    NSThread* ticketsThreadtwo;</span><br><span class="line">    NSCondition* ticketsCondition;</span><br><span class="line">    NSLock *theLock;</span><br><span class="line">&#125;</span><br><span class="line">@property (strong, nonatomic) UIWindow *window;</span><br><span class="line">@property (strong, nonatomic) ViewController *viewController;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions</span><br><span class="line">&#123;</span><br><span class="line">    tickets = 100;</span><br><span class="line">    count = 0;</span><br><span class="line">    theLock = [[NSLock alloc] init];</span><br><span class="line">    // 锁对象</span><br><span class="line">    ticketsCondition = [[NSCondition alloc] init];</span><br><span class="line">    ticketsThreadone = [[NSThread alloc] initWithTarget:self selector:@selector(run) object:nil];</span><br><span class="line">    [ticketsThreadone setName:@&quot;Thread-1&quot;];</span><br><span class="line">    [ticketsThreadone start];</span><br><span class="line"></span><br><span class="line">    ticketsThreadtwo = [[NSThread alloc] initWithTarget:self selector:@selector(run) object:nil];</span><br><span class="line">    [ticketsThreadtwo setName:@&quot;Thread-2&quot;];</span><br><span class="line">    [ticketsThreadtwo start];</span><br><span class="line"></span><br><span class="line">    self.window = [[UIWindow alloc] initWithFrame:[[UIScreen mainScreen] bounds]];</span><br><span class="line">    // Override point for customization after application launch.</span><br><span class="line">    self.viewController = [[ViewController alloc] initWithNibName:@&quot;ViewController&quot; bundle:nil];</span><br><span class="line">    self.window.rootViewController = self.viewController;</span><br><span class="line">    [self.window makeKeyAndVisible];</span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)run&#123;</span><br><span class="line">    while (TRUE) &#123;</span><br><span class="line">        // 上锁</span><br><span class="line">//        [ticketsCondition lock];</span><br><span class="line">        [theLock lock];</span><br><span class="line">        if(tickets &gt;= 0)&#123;</span><br><span class="line">            [NSThread sleepForTimeInterval:0.09];</span><br><span class="line">            count = 100 tickets;</span><br><span class="line">            NSLog(@&quot;当前票数是:%d,售出:%d,线程名:%@&quot;,tickets,count,[[NSThread currentThread] name]);</span><br><span class="line">            tickets--;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">        [theLock unlock];</span><br><span class="line">//        [ticketsCondition unlock];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果没有线程同步的lock，卖票数可能是-1.加上lock之后线程同步保证了数据的正确性。<br>上面例子我使用了两种锁，一种NSCondition ，一种是：NSLock。 NSCondition我已经注释了。</p>
<h4 id="线程的顺序执行"><a href="#线程的顺序执行" class="headerlink" title="线程的顺序执行"></a>线程的顺序执行</h4><p>他们都可以通过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ticketsCondition signal];</span><br></pre></td></tr></table></figure>
<p>发送信号的方式，在一个线程唤醒另外一个线程的等待。</p>
<p>比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;AppDelegate.h&quot;</span><br><span class="line">#import &quot;ViewController.h&quot;</span><br><span class="line">@implementation AppDelegate</span><br><span class="line"></span><br><span class="line">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions</span><br><span class="line">&#123;</span><br><span class="line">    tickets = 100;</span><br><span class="line">    count = 0;</span><br><span class="line">    theLock = [[NSLock alloc] init];</span><br><span class="line">    // 锁对象</span><br><span class="line">    ticketsCondition = [[NSCondition alloc] init];</span><br><span class="line">    ticketsThreadone = [[NSThread alloc] initWithTarget:self selector:@selector(run) object:nil];</span><br><span class="line">    [ticketsThreadone setName:@&quot;Thread-1&quot;];</span><br><span class="line">    [ticketsThreadone start];</span><br><span class="line"></span><br><span class="line">    ticketsThreadtwo = [[NSThread alloc] initWithTarget:self selector:@selector(run) object:nil];</span><br><span class="line">    [ticketsThreadtwo setName:@&quot;Thread-2&quot;];</span><br><span class="line">    [ticketsThreadtwo start];</span><br><span class="line"></span><br><span class="line">    NSThread *ticketsThreadthree = [[NSThread alloc] initWithTarget:self selector:@selector(run3) object:nil];</span><br><span class="line">    [ticketsThreadthree setName:@&quot;Thread-3&quot;];</span><br><span class="line">    [ticketsThreadthree start];</span><br><span class="line">    self.window = [[UIWindow alloc] initWithFrame:[[UIScreen mainScreen] bounds]];</span><br><span class="line">    // Override point for customization after application launch.</span><br><span class="line">    self.viewController = [[ViewController alloc] initWithNibName:@&quot;ViewController&quot; bundle:nil];</span><br><span class="line">    self.window.rootViewController = self.viewController;</span><br><span class="line">    [self.window makeKeyAndVisible];</span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)run3&#123;</span><br><span class="line">    while (YES) &#123;</span><br><span class="line">        [ticketsCondition lock];</span><br><span class="line">        [NSThread sleepForTimeInterval:3];</span><br><span class="line">        [ticketsCondition signal];</span><br><span class="line">        [ticketsCondition unlock];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)run&#123;</span><br><span class="line">    while (TRUE) &#123;</span><br><span class="line">        // 上锁</span><br><span class="line">        [ticketsCondition lock];</span><br><span class="line">        [ticketsCondition wait];</span><br><span class="line">        [theLock lock];</span><br><span class="line">        if(tickets &gt;= 0)&#123;</span><br><span class="line">            [NSThread sleepForTimeInterval:0.09];</span><br><span class="line">            count = 100 tickets;</span><br><span class="line">            NSLog(@&quot;当前票数是:%d,售出:%d,线程名:%@&quot;,tickets,count,[[NSThread currentThread] name]);</span><br><span class="line">            tickets--;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">        [theLock unlock];</span><br><span class="line">        [ticketsCondition unlock];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>wait是等待，我加了一个 线程3 去唤醒其他两个线程锁中的wait</p>
<h5 id="其他同步"><a href="#其他同步" class="headerlink" title="其他同步"></a>其他同步</h5><p>我们可以使用指令 @synchronized 来简化 NSLock的使用，这样我们就不必显示编写创建NSLock,加锁并解锁相关代码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (void)doSomeThing:(id)anObj</span><br><span class="line">&#123;</span><br><span class="line">    @synchronized(anObj)</span><br><span class="line">    &#123;</span><br><span class="line">        // Everything between the braces is protected by the @synchronized directive.</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>还有其他的一些锁对象，比如：循环锁NSRecursiveLock，条件锁NSConditionLock，分布式锁NSDistributedLock等等,可以自己看官方文档学习<br>NSThread下载图片的例子代码：<a href="http://download.csdn.net/detail/totogo2010/4591149" target="_blank" rel="external">http://download.csdn.net/detail/totogo2010/4591149</a></p>
<p>著作权声明：本文由<a href="http://blog.csdn.net/totogo2010/原创，欢迎转载分享。请尊重作者劳动，转载时保留该声明和作者博客链接，谢谢!" target="_blank" rel="external">http://blog.csdn.net/totogo2010/原创，欢迎转载分享。请尊重作者劳动，转载时保留该声明和作者博客链接，谢谢!</a></p>

      
    </div>

    <div>
      
        
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/iOS开发/" rel="tag">#iOS开发</a>
          
            <a href="/tags/多线程/" rel="tag">#多线程</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/03/18/开始使用React Native/" rel="next" title="开始使用React Native">
                <i class="fa fa-chevron-left"></i> 开始使用React Native
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/03/23/提高iOS开发效率的工具/" rel="prev" title="提高iOS开发效率的工具">
                提高iOS开发效率的工具 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/03/21/iOS多线程编程之NSThread的使用/"
           data-title="iOS多线程编程之NSThread的使用" data-url="http://yoursite.com/2016/03/21/iOS多线程编程之NSThread的使用/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://7xojj3.com5.z0.glb.qiniucdn.com/image%2Favatar%2F7ead8c33da3d43552445740501595d76.jpg"
               alt="MaxWellPro" />
          <p class="site-author-name" itemprop="name">MaxWellPro</p>
          <p class="site-description motion-element" itemprop="description">一个90后iOS软件攻城狮，热爱coding，并且喜欢数码、外设、键盘等等。</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">26</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>
          
          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">20</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/JMaxWells/JMaxWells.github.io" target="_blank">
                  
                    <i class="fa fa-gitHub"></i> GitHub
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/2379733281" target="_blank">
                  
                    <i class="fa fa-weibo"></i> Weibo
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator">
            <i class="fa fa-angle-double-up"></i>
          </div>
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#iOS多线程编程之NSThread的使用"><span class="nav-number">1.</span> <span class="nav-text">iOS多线程编程之NSThread的使用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、简介："><span class="nav-number">1.1.</span> <span class="nav-text">1、简介：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-iOS有三种多线程编程的技术，分别是："><span class="nav-number">1.1.1.</span> <span class="nav-text">1.1 iOS有三种多线程编程的技术，分别是：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-三种方式的有缺点介绍："><span class="nav-number">1.1.2.</span> <span class="nav-text">1.2 三种方式的有缺点介绍：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#NSThread"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">NSThread:</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Cocoa-threads"><span class="nav-number">1.1.2.1.1.</span> <span class="nav-text">Cocoa threads</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#POSIX-threads"><span class="nav-number">1.1.2.1.2.</span> <span class="nav-text">POSIX threads</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Multiprocessing-Services"><span class="nav-number">1.1.2.1.3.</span> <span class="nav-text">Multiprocessing Services</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Cocoa-operation"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">Cocoa operation</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#GCD"><span class="nav-number">1.1.2.3.</span> <span class="nav-text">GCD</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、NSThread的使用"><span class="nav-number">1.2.</span> <span class="nav-text">2、NSThread的使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-NSThread-有两种直接创建方式："><span class="nav-number">1.2.1.</span> <span class="nav-text">2.1 NSThread 有两种直接创建方式：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-参数的意义："><span class="nav-number">1.2.2.</span> <span class="nav-text">2.2 参数的意义：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-PS-不显式创建线程的方法："><span class="nav-number">1.2.3.</span> <span class="nav-text">2.3 PS:不显式创建线程的方法：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-下载图片的例子："><span class="nav-number">1.2.4.</span> <span class="nav-text">2.4 下载图片的例子：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-1-新建singeView-app"><span class="nav-number">1.2.4.1.</span> <span class="nav-text">2.4.1  新建singeView app</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-2线程间通讯"><span class="nav-number">1.2.4.2.</span> <span class="nav-text">2.4.2线程间通讯</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-线程同步"><span class="nav-number">1.2.5.</span> <span class="nav-text">2.5 线程同步</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#线程的顺序执行"><span class="nav-number">1.2.5.1.</span> <span class="nav-text">线程的顺序执行</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#其他同步"><span class="nav-number">1.2.5.1.1.</span> <span class="nav-text">其他同步</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator">
            <i class="fa fa-angle-double-down"></i>
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">MaxWellPro</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  


  




<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  

  
  
<script type="text/javascript" src="/js/src/scrollspy.js?v=0.5.0"></script>

<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 1 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = NexT.utils.escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    NexT.motion.middleWares.sidebar = function () {
      var $tocContent = $('.post-toc-content');

      if (CONFIG.scheme !== 'Pisces' && (CONFIG.sidebar.display === 'post' || CONFIG.sidebar.display === 'always')) {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          NexT.utils.displaySidebar();
        }
      }
    };
  });
</script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"maxwellpro"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
      <script src="/vendors/ua-parser-js/dist/ua-parser.min.js"></script>
      <script src="/js/src/hook-duoshuo.js"></script>
    
  





  
  
  

  


</body>
</html>
